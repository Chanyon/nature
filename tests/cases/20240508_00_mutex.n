import coroutine as co

var mutex = co.mutex_t{}
int result_lock = 0

fn sum_lock() {
    mutex.lock()
    for int i = 0; i < 100; i+=1 {
        result_lock += 1
    }
    mutex.unlock()
}

for int i = 0; i < 5000; i+=1 {
    go sum_lock()
}

for int i = 0; i <= 10; i+=1 {
    if result_lock == 500000 {
        break
    }
    println('wait result lock complete..., current =', result_lock)
    co.sleep(1000)
}

println("post result_lock: ", &result_lock, result_lock)

assert(result_lock == 500000)